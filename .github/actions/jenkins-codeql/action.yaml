name: jenkins-codeql
description: Prepares CodeQL and runs the Jenkins-specific rules provided by the Jenkins project

inputs:
  java-version:
    description: Version of Java set up for the build. See actions/setup-java documentation for values.
    required: true
  rules-dir:
    description: Directory containing the Jenkins CodeQL rules.
    required: true
  java-cache:
    description: What kind of Java cache to set up. This needs to correspnd to the build tool (`maven` or `gradle`). Leave empty for no cache.

runs:
  using: composite
  steps:
    - uses: actions/checkout@v2
      with:
        path: jenkins
    - uses: actions/setup-java@v2
      with:
        distribution: 'temurin'
        java-version: ${{ inputs.java-version }}
        cache: ${{ inputs.java-cache }}
    - run: CHECKOUT_DIR=$GITHUB_WORKSPACE/jenkins $GITHUB_ACTION_PATH/scan.sh
      shell: bash
      env:
        GITHUB_TOKEN: ${{ github.token }}
        CODEQL_RULES_DIR: ${{ inputs.rules-dir }}
